syntax = "proto3";

package message;

import "net.proto";
import "minion.proto";


message MessageData {
  bytes recipient_id = 1;
  oneof m {
    net.HolePunchParameters hole_punch = 2;
    minion.Register minion_register = 3;
  };
};

enum SendMessageStatus {
  OK = 0;
  REJECTED = 1;
  DEST_NOT_FOUND = 2;
  FAILED = 3;
};

message SignedMessage {
  bytes sender_id = 1;
  bytes signature = 2;
  bytes sender_cert = 3;   // optional cert
  bytes data = 4;          // signed bytes of type MessageData
  int32 ttl = 5;
};

message SendMessageResponse {
  SendMessageStatus status = 1;
  SignedMessage message = 2;
};

service Message {
  rpc Send(SignedMessage) returns (SendMessageResponse);
  rpc SendAsync(SignedMessage) returns (SendMessageResponse);
  rpc Stream(stream SignedMessage) returns (stream SignedMessage);
};
